<?page title="DOCSYS" ?>
<arya xmlns="aryaportal.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="aryaportal.org arya.xsd">
	<script>
var fileCnt = 0;$(document).ready( function () {				<%if (request.getAttribute(AgemConstant.AGEM_MESSAGE) != null) {%>			Agem.message('<%=request.getAttribute(AgemConstant.AGEM_MESSAGE)%>');		<%}%>		$("#dosyaForm").iframePostForm({ iframeID: 'dosyaFormIFramePost', json : 1, 			post : function () { 				Agem.perde(true, null, 'Lütfen bekleyin...');				$('#denetimTip').val('3');			},			complete : function (response) {					if(response.dosyaId) {						$.ajax({"url":"genel/sayfaDosya/add.do",							data:{ sayfaId: <bean:write name="p_sayfaIdParam"/>, dosyaId: response.dosyaId, sira: fileCnt, json:1 },							async : false,							timeout: 30000, 							dataType:"json", 							success:function(data){  								fileCnt++;								$('.sayfaDosya').append(									"<div class='dosyaCerceve' id='dosyaCerceve_" + data.sayfaBelgeId + "' fileIndex='"+ fileCnt+"'>" + 										"<a href='javascript:dosyaSil("+data.sayfaBelgeId + ","+data.dosyaId +");' class='removeLink'> <img src='agem/images/remove.png' class='kapat_icon_16' id='remove"+data.dosyaId+"'/></a>" +										"<img id='"+data.dosyaId + "' src='agem/images/file.png' class='dosya'  title='"+ $("#tanim").val()+"'/>" +										"<div id='dosyaTanimDiv"+data.sayfaBelgeId+"' style='padding-left:3px; padding-right:3px; text-align:center; overflow: hidden; white-space: nowrap; -o-text-overflow: ellipsis; text-overflow: ellipsis'>" +										$("#tanim").val() +										"</div>" +									"</div>"																	);																AgemTable.DATA[fileCnt] = { 											 sayfaBelgeId:data.sayfaBelgeId											,sayfaId: data.sayfaId											,dosyaId : data.dosyaId											,sira: data.sira											,tanim: $("#tanim").val()								};								$('#remove'+data.dosyaId).hover( changeRemoveIcon );								$('#'+data.dosyaId).dblclick(function() { window.open( "getDosya.do?id=" + $(this).attr('id')); });								$('#'+data.dosyaId).parent().click( function() { selectImage($(this)); } );								selectImage($('#'+data.dosyaId).parent());															},							error:function(xhr,err,e){ alert( "Hata: " + err );}});					} else if (response.message) {						alert(response.message);					};					Agem.perde(false);			} });		addRemoveHover();		$('#sayfaDosya').sortable( {			update : function(ser)			{				Agem.perde(true, null, 'Lütfen bekleyin...');				$.ajax({"url":"genel/sayfaDosya/edit.do",					data:{ sayfaId: <bean:write name="p_sayfaIdParam"/>, siralama: $('#sayfaDosya').sortable( "serialize"), json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){  					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});				Agem.perde(false);			}		});		<%		if ((p_yetki != null || !"".equals(p_yetki)) && "1".equals(p_yetki)) {		%>				$("#multiUploadBtn").remove();				$("#kaydet").remove();				$("#yeni").remove();				<% yetkiVar = false; %>		<%		}		%>	});var _SELECTED = null;var _SELECTED_INDEX = -1;function selectImage(r) {		if (_SELECTED != null) {		_SELECTED.removeClass("dosyaCerceveSelected")	} 	if (r) {		_SELECTED = r;		_SELECTED.addClass("dosyaCerceveSelected");				var index = r.attr("fileIndex");		_SELECTED_INDEX = index;		Agem.setValue(AgemTable.DATA[index]);		$('#dosya').attr("disabled", true);	} else {		_SELECTED = null;		_SELECTED_INDEX = -1;	}}function changeRemoveIcon() {	if ($(this).attr('className') =='kapat_icon_16')		$(this).removeClass('kapat_icon_16').addClass('kapat_icon_24');	else			$(this).removeClass('kapat_icon_24').addClass('kapat_icon_16');}function addRemoveHover() {		$('.kapat_icon_16').hover( changeRemoveIcon );		$('.dosya').dblclick(function() { window.open( "getDosya.do?id=" + $(this).attr('id')); });		$('.dosyaCerceve').click( function() { selectImage($(this)); } );}function dosyaSil(sayfaBelgeId, dosyaId) {	<%	if (!yetkiVar) {	%>		Agem.error("Yetkiniz yok.");		return false;	<%	}	%>	if (confirm('Resmi silmek istediğinizden emin misiniz ?')) {		Agem.perde(true, null, 'Lütfen bekleyin...');		$.ajax({"url":"genel/sayfaDosya/delete.do",			data:{ sayfaBelgeId: sayfaBelgeId, json:1 },			async : false,			timeout: 30000, 			dataType:"json", 			success:function(data){ 				$.ajax({"url":"deleteDosya.do",					data:{ dosyaId: dosyaId, json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){ 						$('#dosyaCerceve_'+sayfaBelgeId).remove();						dosyaTemizle();					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});			},			error:function(xhr,err,e){ alert( "Hata: " + err );}});		Agem.perde(false);	}}function dosyaUpdate() {	<%	if (!yetkiVar) {	%>		Agem.error("Yetkiniz yok.");		return false;	<%	}	%>	if($("#dosyaId").val()) {		Agem.perde(true, null, 'Lütfen bekleyin...');		$.ajax({"url":"genel/sayfaDosya/edit.do",			data:{ sayfaBelgeId: $("#sayfaBelgeId").val(), sayfaId: $("#sayfaId").val(), dosyaId: $("#dosyaId").val(), sira: $("#sira").val(), json:1 },			async : false,			timeout: 30000, 			dataType:"json", 			success:function(data){				$.ajax({"url":"editDosya.do",					data:{ dosyaId: $("#dosyaId").val(), tanim: $("#tanim").val(), tanimUpdate:'true', json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){  						AgemTable.DATA[_SELECTED_INDEX].tanim = $("#tanim").val(); 						$('#dosyaTanimDiv'+$("#sayfaBelgeId").val()).html(AgemTable.DATA[_SELECTED_INDEX].tanim);					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});			},			error:function(xhr,err,e){ alert( "Hata: " + err );}});		Agem.perde(false);	}	}function dosyaKaydet() {	<%	if (!yetkiVar) {	%>		Agem.error("Yetkiniz yok.");		return false;	<%	}	%>	if ($("#dosyaId").val()) {		dosyaUpdate();	} else {		if (AgemForm.validate($("#dosyaForm")[0])) {			$('#dosyaForm').submit();		}	}}function dosyaTemizle() {	AgemForm.temizle($("#dosyaForm")[0]);	$('#dosya').removeAttr("disabled");	selectImage(null);}fileCnt = <%=n%>; AgemTable.DATA[<%=n%>]=<%=AgemUtils.jsObject(item)%>	</script>
</arya>
