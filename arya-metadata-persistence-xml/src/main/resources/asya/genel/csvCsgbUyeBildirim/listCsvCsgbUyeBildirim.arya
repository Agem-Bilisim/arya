<?page title="DOCSYS" ?>
<arya xmlns="aryaportal.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="aryaportal.org arya.xsd">
	<script>
var _YARDIM_SOZCUK = 'genel/csvCsgbUyeBildirim/list';var uyeBildirimId = null;$(document).ready( 	function () {		<agem:access URL="genel/csvCsgbUyeBildirim/edit">			if ($('.exportlinks').length > 0) {				$('<a/>', {     					id: 'kaydet-link',     					href: "javascript:islem()",     					title: 'Tutarsızlığı Düzelt'     				}).html("<span title='Tutarsızlığı Düzelt' class='export-icon save-off' onmouseover=\"Other.changeClass(this, 'save-off', 'save-on')\" onmouseout=\"Other.changeClass(this, 'save-on', 'save-off')\"></span>").prependTo('.exportlinks');						$('.save-off').parent().attr("href", "javascript:islem()");										$('<a/>', {     					id: 'arama-link',     					href: "javascript:isyerineGit()",     					title: 'İşyerine Git'     				}).html("<span title='İşyerine Git' class='export-icon search-off' onmouseover=\"Other.changeClass(this, 'search-off', 'search-on')\" onmouseout=\"Other.changeClass(this, 'search-on', 'search-off')\"></span>").prependTo('.exportlinks');						$('.search-off').parent().attr("href", "javascript:isyerineGit()");				$('#arama-link').hide();			}		</agem:access>	});function isyerineGit(){	var d = AgemTable.get(uyeBildirimId);	if(d.isyeriId != null) {		<agem:access URL="genel/isyeri/select">		AgemWM.window(		{			label: 'İşyeri İşlemleri',			link:"genel/isyeri/select.do?isyeriIdParam=" + d.isyeriId + "&isyeriId=" + d.isyeriId,			tab:"#genelIsyeriSelect",			paramSelector:"#genelIsyeriSelect",			width: 800,			height: 600						});	 	</agem:access>	}	else if(d.isyeriId == null && d.isyeriSgkNo != null){		<agem:access URL="genel/csgbIsyeri/select">		Agem.perde(true, null, 'İşyeri kaydına gidiliyor. Lütfen bekleyin...');		setTimeout(function(){			$.ajax({"url":"genel/csgbIsyeri/autocomplete.do",				data:{ sgkNoParam: sgkNoParcala(d.isyeriSgkNo),json:1 },				timeout: 300000, 				dataType:"text", 				success:function(data){					if(data.length > 0){						data = eval("("+data+")");						AgemWM.window(							{								label: 'İşyeri İşlemleri',								link:"genel/csgbIsyeri/select.do?isyeriId=" + data.results[0].isyeriId,								tab:"#genelCsgbIsyeriSelect",								paramSelector:"#genelCsgbIsyeriSelect",								width: 800,								height: 600											});							Agem.perde(false);					}					else {						alert("Kayıt bulunamadı.");						Agem.perde(false);					}				},				error:function(xhr,err,e){ alert( "Kayıt aranırken hata oluştu..."); Agem.perde(false); }			});		}, 1000);					 	</agem:access>	}    }var sgkNoParcala = function(sgkNo){	var arr = [sgkNo.substr(0,1),				sgkNo.substr(1,4),				sgkNo.substr(5,2),				sgkNo.substr(7,2),				sgkNo.substr(9,7),				sgkNo.substr(16,3),				sgkNo.substr(19,2),				sgkNo.substr(21,2),				sgkNo.substr(23,3)]; 	return arr.join(".");};var islem = function (){	if ($("#liste tr.empty").length > 0) {		alert("Listede işlenecek kayıt yok...");		return;	}		var json = {json:1};		if (uyeBildirimId != null) {		var d = AgemTable.get(uyeBildirimId);		json.tckNoParam = d.tckNo;		json.cikisNedeniParam = d.cikisNedeni;	}	else {		json.isyeriIdParam = '<bean:write name="p_isyeriIdParam"/>';		json.isyeriUnvanParam = '<bean:write name="p_isyeriUnvanParam"/>';		json.isyeriSgkKisaNoParam = '<bean:write name="p_isyeriSgkKisaNoParam"/>';		json.tckNoParam = '<bean:write name="p_tckNoParam"/>';		json.subeParam = '<bean:write name="p_subeParam"/>';		json.cikisNedeniParam ='<bean:write name="p_cikisNedeniParam"/>';	}		<agem:access URL="genel/csvCsgbUyeBildirim/edit">		var text = "ÇSGB kayıtlarından üye bildirimleri sisteme kaydedilecektir. Devam etmek istiyor musunuz?";		if(!confirm(text)){			return false;		}		Agem.perde(true, null, 'Tutarsızlıklar düzeltiliyor. Lütfen bekleyin...');		setTimeout(function(){			$.ajax({"url":"genel/csvCsgbUyeBildirim/edit.do",				data: json,				timeout: 300000, 				dataType:"json", 				success:function(data){				},				error:function(xhr,err,e){ if (e) alert(e); else alert( "Kayıtlar düzenlenirken hata oluştu..."); Agem.perde(false); }			});			setTimeout(logYenile, 1000);		}, 1000);	</agem:access>};function logYenile(){	$.ajax({		url: "genel/csvCsgbUyeBildirim/select.do",		data: {},		timeout: 300000,		type: "post",		dataType: "html", 		success: function(h){			var l = $("#log", h);			if(l != 'undefined'){				var s = $(l).html();				var attr = $(s).attr('finallog');				if(s && s.length > 0){					var c = $(s).css('color');					if(c != 'red'){						if (typeof attr !== 'undefined' && attr !== false) {							Other.displayTagYenile();							Agem.message(s);							Agem.perde(false);						} else {							Agem.message(s);							setTimeout(function(){								logYenile();							}, 1000);												}							} else {						alert(s);						Agem.message(s);						Agem.perde(false);					}				}			}		},		error: function(xhr,err,e){ Agem.error("Hata oluştu."); }	});}AgemTable.rowDblClick = function(id) {	var d = AgemTable.get(id);	if (parseInt(d.kisiId)) {		<agem:access URL="genel/isci/select">			AgemWM.window(					{						label: 'İşçi İşlemleri', 						link:"genel/isci/select.do?kisiId=" + d.kisiId + "&kisiIdParam=" + d.kisiId,						width: 800,						height: 600									});		</agem:access>	}	};AgemTable.rowClick = function(id) {	$('#arama-link').show();	if (!id) {		id = AgemTable.SELECTED_ID;		if (id == null) {			Agem.error("Lütfen kayıt seçiniz.");			return;		}	}	uyeBildirimId = id;};	</script>
</arya>
