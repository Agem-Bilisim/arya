<?page title="DOCSYS" ?>
<arya xmlns="aryaportal.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="aryaportal.org arya.xsd">
	<script>
var fileOrder = -1;var totalFileCount;var maxFileCount = <bean:write name="p_maxFileCount"/>;var denetimTip = '<bean:write name="p_denetimTip"/>';var size = '<bean:write name="p_sizeParam"/>';$(document).ready( function () {		if (size == 0) {			$("#goster").hide();		}				$('#denetimTip').val(denetimTip);		totalFileCount = (fileOrder == -1) ? 0 : (fileOrder+1);		fileOrder = (fileOrder == -1) ? 0 : fileOrder;				<%if (request.getAttribute(AgemConstant.AGEM_MESSAGE) != null) {%>			Agem.message('<%=request.getAttribute(AgemConstant.AGEM_MESSAGE)%>');		<%}%>		$("#dosyaForm").iframePostForm({ iframeID: 'dosyaFormIFramePost', json : 1, 			post : function () { 				Agem.perde(true, null, 'Lütfen bekleyin...');			},			complete : function (response) {					if(response.dosyaId) {						$.ajax({"url":"genel/nesneDosya/add.do",							data:{ nesneKod: '<bean:write name="p_nesneKodParam"/>', nesneId: <bean:write name="p_nesneIdParam"/>, dosyaId: response.dosyaId, sira: fileOrder, json:1 },							async : false,							timeout: 30000, 							dataType:"json", 							success:function(data){  								fileOrder++;								$('.nesneDosya').append(									"<div class='dosyaCerceve' id='dosyaCerceve_" + data.nesneDosyaId + "' fileIndex='"+ fileOrder+"'>" + 										"<a href='javascript:dosyaSil("+data.nesneDosyaId + ","+data.dosyaId +");' class='removeLink'> <img src='agem/images/remove.png' class='kapat_icon_16' id='remove"+data.dosyaId+"'/></a>" +										"<img id='"+data.dosyaId + "' src='agem/images/file.png' class='dosya'  title='"+ $("#tanim").val()+"'/>" +										"<div id='dosyaTanimDiv"+data.nesneDosyaId+"' style='padding-left:3px; padding-right:3px; text-align:center; overflow: hidden; white-space: nowrap; -o-text-overflow: ellipsis; text-overflow: ellipsis'>" +										$("#tanim").val() +										"</div>" +									"</div>"								);								AgemTable.DATA[fileOrder] = { 											 nesneDosyaId:data.nesneDosyaId											,nesneKod: data.nesneKod											,nesneId: data.nesneId											,dosyaId : data.dosyaId											,sira: data.sira											,tanim: $("#tanim").val()								};								$('#remove'+data.dosyaId).hover( changeRemoveIcon );								$('#'+data.dosyaId).dblclick(function() { window.open( "getDosya.do?id=" + $(this).attr('id')); });								$('#'+data.dosyaId).parent().click( function() { selectImage($(this)); } );								selectImage($('#'+data.dosyaId).parent());								totalFileCount++;															},							error:function(xhr,err,e){ alert( "Hata: " + err );}});					} else if (response.message) {						alert(response.message);					};					Agem.perde(false);			} });		addRemoveHover();		$('#nesneDosya').sortable( {			update : function(ser)			{				Agem.perde(true, null, 'Lütfen bekleyin...');				$.ajax({"url":"genel/nesneDosya/edit.do",					data:{ nesneKod: <bean:write name="p_nesneKodParam"/>, nesneId: <bean:write name="p_nesneIdParam"/>, siralama: $('#sayfaDosya').sortable( "serialize"), json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){  					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});				Agem.perde(false);			}		});			});var _SELECTED = null;var _SELECTED_INDEX = -1;function selectImage(r) {		if (_SELECTED != null) {		_SELECTED.removeClass("dosyaCerceveSelected")	} 	if (r) {		_SELECTED = r;		_SELECTED.addClass("dosyaCerceveSelected");				var index = r.attr("fileIndex");		_SELECTED_INDEX = index;		Agem.setValue(AgemTable.DATA[index]);		$('#dosya').attr("disabled", true);	} else {		_SELECTED = null;		_SELECTED_INDEX = -1;	}}function changeRemoveIcon() {	if ($(this).attr('className') =='kapat_icon_16')		$(this).removeClass('kapat_icon_16').addClass('kapat_icon_24');	else			$(this).removeClass('kapat_icon_24').addClass('kapat_icon_16');}function addRemoveHover() {		$('.kapat_icon_16').hover( changeRemoveIcon );		$('.dosya').dblclick(function() { window.open( "getDosya.do?id=" + $(this).attr('id')); });		$('.dosyaCerceve').click( function() { selectImage($(this)); } );}function dosyaSil(nesneDosyaId, dosyaId) {	if (confirm('Dosyayı silmek istediğinizden emin misiniz ?')) {		Agem.perde(true, null, 'Lütfen bekleyin...');		$.ajax({"url":"genel/nesneDosya/delete.do",			data:{ nesneDosyaId: nesneDosyaId, json:1 },			async : false,			timeout: 30000, 			dataType:"json", 			success:function(data){ 				$.ajax({"url":"deleteDosya.do",					data:{ dosyaId: dosyaId, json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){ 						$('#dosyaCerceve_'+nesneDosyaId).remove();						dosyaTemizle();						totalFileCount--;					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});			},			error:function(xhr,err,e){ alert( "Hata: " + err );}});		Agem.perde(false);	}}function dosyaUpdate() {	if($("#dosyaId").val()) {		Agem.perde(true, null, 'Lütfen bekleyin...');		$.ajax({"url":"genel/nesneDosya/edit.do",			data:{ nesneDosyaId: $("#nesneDosyaId").val(), nesneKod: $("#nesneKod").val(),  nesneId: $("#nesneId").val(), dosyaId: $("#dosyaId").val(), sira: $("#sira").val(), json:1 },			async : false,			timeout: 30000, 			dataType:"json", 			success:function(data){				$.ajax({"url":"editDosya.do",					data:{ dosyaId: $("#dosyaId").val(), tanim: $("#tanim").val(), tanimUpdate:'true', json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){  						AgemTable.DATA[_SELECTED_INDEX].tanim = $("#tanim").val(); 						$('#dosyaTanimDiv'+$("#nesneDosyaId").val()).html(AgemTable.DATA[_SELECTED_INDEX].tanim);					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});			},			error:function(xhr,err,e){ alert( "Hata: " + err );}});		Agem.perde(false);	}	}function dosyaKaydet() {	if ($("#dosyaId").val()) {		dosyaUpdate();	} else {		if (maxFileCount > totalFileCount) {			if (AgemForm.validate($("#dosyaForm")[0])) {				$('#dosyaForm').submit();			}		} else {			Agem.message('Bu kayda en fazla ' + maxFileCount + ' kadar dosya ekleyebilirsiniz...','x');		}	}}function dosyaTemizle() {	AgemForm.temizle($("#dosyaForm")[0]);	$('#denetimTip').val(denetimTip);	$('#dosya').removeAttr("disabled");	selectImage(null);}function bilgiGoster() {	AgemWM.modal({content: "<div style='overflow: auto; height: 225px; padding-left: 10px; padding-right: 10px;'>"+Agem.byId("bilgiDiv").innerHTML+"</div>", label: "Dosya Bilgi", width: "460", height:"270"});}function tumDosyalariGoster() {	AgemWM.window(	{		modal : true,		label: "C.S.G.B Üyelik Bildirim Dosyaları", 		url:"genel/nesneDosya/list.do?pageSize=-1&nesneKodParam="+ '<bean:write name="p_nesneKodParam"/>' +"&nesneIdParam=1&size=-1",		id : "nesneDosyaWindow",		width: 800, 		height: 600,		opener: window	});}fileOrder = <%=n%>; AgemTable.DATA[<%=n%>]=<%=AgemUtils.jsObject(item)%>	</script>
</arya>
