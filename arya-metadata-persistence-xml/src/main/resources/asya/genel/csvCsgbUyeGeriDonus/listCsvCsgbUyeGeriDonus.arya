<?page title="DOCSYS" ?>
<arya xmlns="aryaportal.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="aryaportal.org arya.xsd">
	<script>
var _YARDIM_SOZCUK = 'genel/csvCsgbUyeGeriDonus/list';$(document).ready( 	function () {		<agem:access URL="genel/csvCsgbUyeGeriDonus/edit">			if ($('.exportlinks').length > 0) {					$('<a/>', {     						id: 'kaydet-link',     						href: "javascript:islem()",     						title: 'Tutarsızlığı Düzelt'     					}).html("<span title='Tutarsızlığı Düzelt' class='export-icon save-off' onmouseover=\"Other.changeClass(this, 'save-off', 'save-on')\" onmouseout=\"Other.changeClass(this, 'save-on', 'save-off')\"></span>").prependTo('.exportlinks');							$('.save-off').parent().attr("href", "javascript:islem()");					}		</agem:access>	});var editCalissinMi = false;var islem = function (){		if ($("#liste tr.empty").length > 0) {		alert("Listede işlenecek kayıt yok...");		return;	}		var param = '';	<logic:notEmpty name="tcyeGoreDusurCheckbox">		var c = $('<div align="left"><br/>&nbsp;<span>ÇSGB kayıtlarından geri dönüşleri sisteme kaydedilecektir. &nbsp;Devam etmek istiyor musunuz?</span><br/>'+				'<p><input type="checkbox" id="tcyeGoreDusur" name="tcyeGoreDusur" value="1"> TC ye göre düşür.</p></div>');				AgemWM.modal({			id:'duzenleModal',			width: 500,			height: 150,			label : "",			close : true,			content : c,			onClose: function(){				if(editCalissinMi){					setTimeout(function(){						edit(param);					}, 1000);				}			},			buttons : [{				id : 'alertWnd-editBtn',				label : 'Düzenle',				func : function(obj) {					if(obj.tcyeGoreDusur == 1) {						param='?tcyeGoreDusur=1';					}					editCalissinMi = true;					return true;				}			}, {				id : 'alertWnd-closeBtn',				label : 'İptal',				func : function() {					editCalissinMi = false;					return true;				}			}],		});	</logic:notEmpty>		<logic:empty name="tcyeGoreDusurCheckbox">		edit(param);	</logic:empty>	};function edit(param){	<agem:access URL="genel/csvCsgbUyeGeriDonus/edit">		var text = "ÇSGB kayıtlarından geri dönüşleri sisteme kaydedilecektir. Devam etmek istiyor musunuz?";		<logic:empty name="tcyeGoreDusurCheckbox">			if(!confirm(text)){				return false;			}		</logic:empty>		Agem.perde(true, null, 'Tutarsızlıklar düzeltiliyor. Lütfen bekleyin...');		setTimeout(function(){			$.ajax({"url":"genel/csvCsgbUyeGeriDonus/edit.do" + param,				data:{json:1, 					isyeriIdParam :'<bean:write name="p_isyeriIdParam"/>',					subeParam : '<bean:write name="p_subeParam"/>',					uyelikDurumParam : '<bean:write name="p_uyelikDurumParam"/>',					cikisNedeniParam : '<bean:write name="p_cikisNedeniParam"/>'					},				timeout: 300000, 				dataType:"json", 				success:function(data){					logYenile();				},				error:function(xhr,err,e){ alert( "Kayıtlar düzenlenirken hata oluştu..."); Agem.perde(false); }			});		}, 1000);	</agem:access>}function logYenile(){	$.ajax({		url: "genel/csvCsgbUyeGeriDonus/select.do",		data: {},		timeout: 300000,		type: "post",		dataType: "html", 		success: function(h){			var l = $("#log", h);			if(l != 'undefined'){				var s = $(l).html();				var attr = $(s).attr('finallog');				if(s && s.length > 0){					var c = $(s).css('color');					if(c != 'red'){						if (typeof attr !== 'undefined' && attr !== false) {							Agem.message(s);							Agem.perde(false);							Other.displayTagYenile();						} else {							console.log(s);							Agem.message(s);							setTimeout(function(){								logYenile();							}, 1000);												}					} else {						Other.displayTagYenile();						Agem.message(s);						Agem.perde(false);					}				}			}		},		error: function(xhr,err,e){ Agem.error("Hata oluştu."); }	});}AgemTable.rowDblClick = function(id) {	if (parseInt(id)) {		<agem:access URL="genel/isci/select">			AgemWM.window(					{						label: 'İşçi İşlemleri', 						link:"genel/isci/select.do?kisiId=" + id + "&kisiIdParam=" +id,						width: 800,						height: 600									});		</agem:access>	} else {		<agem:access URL="genel/isci/list">			var tckNoAdSoyad = id.toString().substring(1).split("&");			AgemWM.window(					{						label: 'İşçi İşlemleri',						link:"genel/isci/list.do?kisiParam.checkTckNoAdSoyadParam=" + tckNoAdSoyad[0] + "&kisiParam.checkTckNoAdSoyadParam=" + tckNoAdSoyad[1]+ "&kisiParam.checkTckNoAdSoyadParam=" + tckNoAdSoyad[2],						tab:"#genelIsciList",						paramSelector:"#genelIsciList",						width: 800,						height: 600									});		</agem:access>	}};	</script>
</arya>
