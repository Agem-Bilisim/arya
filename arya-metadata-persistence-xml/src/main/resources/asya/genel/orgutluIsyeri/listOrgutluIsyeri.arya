<?page title="DOCSYS" ?>
<arya xmlns="aryaportal.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="aryaportal.org arya.xsd">
	<script>
var _C_ISYERI_TUR = <agem:jsArray all="false" dictionary="<%=Constant.APP_ISYERI_TUR%>" />;var _C_ISVEREN_SENDIKA = <agem:jsArray all="true" collection="<%=Constant.C_SESSION_ISVEREN_SENDIKA_LIST%>" />;var fileCnt = 0;$(document).ready( function () {		AgemForm.setComboContent("isyeriTur", _C_ISYERI_TUR);		AgemForm.setComboContent("isverenSendikaId", _C_ISVEREN_SENDIKA);			$('#tanimLabel').html("Ünvan");		$('#tanimLabel').addClass("agem-mandatory");		$('#tanim').attr("mandatory","true");				<%if (request.getAttribute(AgemConstant.AGEM_MESSAGE) != null) {%>			Agem.message('<%=request.getAttribute(AgemConstant.AGEM_MESSAGE)%>');		<%}%>		$("#dosyaForm").iframePostForm({ iframeID: 'dosyaFormIFramePost', json : 1, 			post : function () {  				Agem.perde(true, null, 'Lütfen bekleyin...');				$('#denetimTip').val('98');			},			complete : function (response) {					if(response.dosyaId) {						$.ajax({"url":"genel/orgutluIsyeri/add.do",							data:{ logoDosyaId: response.dosyaId, sira: fileCnt, unvan:response.tanim, json:1, isyeriTur: $('#isyeriTur').val(), isverenSendikaId: $('#isverenSendikaId').val()},							async : false,							timeout: 30000, 							dataType:"json", 							success:function(data){  								fileCnt++;								$('.sayfaResim').append(									"<div class='resimCerceve' id='resimCerceve_" + data.orgutluIsyeriId + "' fileIndex='"+ fileCnt+"'>" + 										"<a href='javascript:resimSil("+data.orgutluIsyeriId + ","+data.logoDosyaId +");' class='removeLink'> <img src='agem/images/remove.png' class='kapat_icon_16' id='remove"+data.logoDosyaId+"'/></a>" +										"<img id='"+data.logoDosyaId + "' src='getDosya.do?dosyaId="+data.logoDosyaId+"' class='resim' />" +									"</div>"								);																AgemTable.DATA[fileCnt] = { 											 orgutluIsyeriId:data.orgutluIsyeriId											,unvan: data.unvan											,isyeriTur : data.isyeriTur											,isverenSendikaId : data.isverenSendikaId											,logoDosyaId : data.logoDosyaId											,sira: data.sira											,isyeriId: data.isyeriId								};								$('#remove'+data.logoDosyaId).hover( changeRemoveIcon );								$('#'+data.logoDosyaId).dblclick(function() { window.open( "getDosya.do?id=" + $(this).attr('id'));  });								$('#'+data.logoDosyaId).parent().click( function() { selectImage($(this)); } );								selectImage($('#'+data.logoDosyaId).parent());															},							error:function(xhr,err,e){ alert( "Hata: " + err );}});					} else if (response.message) {						alert(response.message);					};					Agem.perde(false);			} });		addRemoveHover();		$('#sayfaResim').sortable( {			update : function(ser)			{			$.ajax({"url":"genel/orgutluIsyeri/edit.do",				data:{ siralama: $('#sayfaResim').sortable( "serialize"), json:1 },				async : false,				timeout: 30000, 				dataType:"json", 				success:function(data){  				},				error:function(xhr,err,e){ alert( "Hata: " + err );}});					}			});				<agem:access not="true" URL="genel/orgutluIsyeri/edit">		$("#kaydet").remove();		</agem:access>		<agem:access not="true" URL="genel/orgutluIsyeri/add">		$("#yeni").remove();		</agem:access>			});var _SELECTED = null;var _SELECTED_INDEX = -1;function selectImage(r) {		if (_SELECTED != null) {		_SELECTED.removeClass("resimCerceveSelected")	} 	if (r) {		_SELECTED = r;		_SELECTED.addClass("resimCerceveSelected");				var index = r.attr("fileIndex");		_SELECTED_INDEX = index;		Agem.setValue(AgemTable.DATA[index]);		$("#tanim").val( AgemTable.DATA[_SELECTED_INDEX].unvan );		$("#dosyaId").val( AgemTable.DATA[_SELECTED_INDEX].logoDosyaId );		$("#isyeriTur").val( AgemTable.DATA[_SELECTED_INDEX].isyeriTur );		$("#isverenSendikaId").val( AgemTable.DATA[_SELECTED_INDEX].isverenSendikaId );		$('#dosya').attr("disabled", true);		$('#dosya').parent().hide();	} else {		_SELECTED = null;		_SELECTED_INDEX = -1;	}}function changeRemoveIcon() {	if ($(this).attr('className') =='kapat_icon_16')		$(this).removeClass('kapat_icon_16').addClass('kapat_icon_24');	else			$(this).removeClass('kapat_icon_24').addClass('kapat_icon_16');}function addRemoveHover() {		$('.kapat_icon_16').hover( changeRemoveIcon );		$('.resim').dblclick(function() { window.open( $(this).attr('src')); });		$('.resimCerceve').click( function() { selectImage($(this)) } );}function resimSil(id, dosyaId) {	<agem:access not="true" URL="genel/orgutluIsyeri/delete">		Agem.error("Yetkiniz yok.");		return false;	</agem:access>	if (confirm('İşyerini silmek istediğinizden emin misiniz ?')) {		$.ajax({"url":"genel/orgutluIsyeri/delete.do",			data:{ orgutluIsyeriId: id, json:1 },			async : false,			timeout: 30000, 			dataType:"json", 			success:function(data){ 				$.ajax({"url":"deleteDosya.do",					data:{ dosyaId: dosyaId, json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){ 						$('#resimCerceve_'+id).remove();						dosyaTemizle();					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});			},			error:function(xhr,err,e){ alert( "Hata: " + err );}});		}}function resimUpdate() {	<agem:access not="true" URL="genel/orgutluIsyeri/edit">		Agem.error("Yetkiniz yok.");		return false;	</agem:access>	if($("#dosyaId").val()) {		$.ajax({"url":"genel/orgutluIsyeri/edit.do",			data:{ orgutluIsyeriId: $("#orgutluIsyeriId").val(), logoDosyaId: $("#dosyaId").val(), sira: $("#sira").val(), json:1, unvan: $("#tanim").val(), isyeriTur: $('#isyeriTur').val(),isverenSendikaId: $('#isverenSendikaId').val()},			async : false,			timeout: 30000, 			dataType:"json", 			success:function(data){				$.ajax({"url":"editDosya.do",					data:{ dosyaId: $("#dosyaId").val(), tanim: $("#tanim").val(), tanimUpdate:'true', json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){  						AgemTable.DATA[_SELECTED_INDEX].unvan = $("#tanim").val(); 						AgemTable.DATA[_SELECTED_INDEX].isyeriTur = $("#isyeriTur").val(); 						AgemTable.DATA[_SELECTED_INDEX].isverenSendikaId = $("#isverenSendikaId").val(); 					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});			},			error:function(xhr,err,e){ alert( "Hata: " + err );}});	} else if (response.message) {		alert(response.message);	};	}function dosyaKaydet() {	if ($("#dosyaId").val()) {		resimUpdate();	} else {		<agem:access not="true" URL="genel/orgutluIsyeri/add">			Agem.error("Yetkiniz yok.");			return false;		</agem:access>		if (AgemForm.validate($("#dosyaForm")[0])) {			$('#dosyaForm').submit();		}	}}function dosyaTemizle() {		AgemForm.temizle($("#dosyaForm")[0]);	$('#dosya').removeAttr("disabled");	$('#dosya').parent().show();		selectImage(null);}fileCnt = <%=n%>; AgemTable.DATA[<%=n%>]=<%=AgemUtils.jsObject(item)%>	</script>
</arya>
