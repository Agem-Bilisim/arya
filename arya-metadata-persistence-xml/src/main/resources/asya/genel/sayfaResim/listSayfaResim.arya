<?page title="DOCSYS" ?>
<arya xmlns="aryaportal.org" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="aryaportal.org arya.xsd">
	<script>
var _C_RESIM_EK_BILGI = <agem:jsArray all="false" dictionary="<%=Constant.APP_RESIM_EK_BILGI%>" />;var fileCnt = 0;$(document).ready( function () {				AgemForm.createRadioButtons($("#ekBilgiDiv"),"ekBilgi",_C_RESIM_EK_BILGI, false, true);		<%if (request.getAttribute(AgemConstant.AGEM_MESSAGE) != null) {%>			Agem.message('<%=request.getAttribute(AgemConstant.AGEM_MESSAGE)%>');		<%}%>		$("#dosyaForm").iframePostForm({ iframeID: 'dosyaFormIFramePost', json : 1, 			post : function () {					Agem.perde(true, null, 'Lütfen bekleyin...');					$('#denetimTip').val('1-'+AgemForm.getRadioButtonValue("ekBilgi"));			},			complete : function (response) {					if(response.dosyaId) {						$.ajax({"url":"genel/sayfaResim/add.do",							data:{ sayfaId: <bean:write name="p_sayfaIdParam"/>, dosyaId: response.dosyaId, sira: fileCnt, json:1, ekBilgi: AgemForm.getRadioButtonValue("ekBilgi") },							async : false,							timeout: 30000, 							dataType:"json", 							success:function(data){  								fileCnt++;								$('.sayfaResim').append(									"<div class='resimCerceve ekBilgi"+data.ekBilgi +"' id='resimCerceve_" + data.sayfaBelgeId + "' fileIndex='"+ fileCnt+"'>" + 										"<a href='javascript:resimSil("+data.sayfaBelgeId + ","+data.dosyaId +");' class='removeLink'> <img src='agem/images/remove.png' class='kapat_icon_16' id='remove"+data.dosyaId+"'/></a>" +										"<img id='"+data.dosyaId + "' src='getDosya.do?dosyaId="+data.dosyaId+"' class='resim' />" +									"</div>"								);																AgemTable.DATA[fileCnt] = { 											 sayfaBelgeId:data.sayfaBelgeId											,sayfaId: data.sayfaId											,dosyaId : data.dosyaId											,sira: data.sira											,tanim: $("#tanim").val()											,ekBilgi: data.ekBilgi								};								$('#remove'+data.dosyaId).hover( changeRemoveIcon );								$('#'+data.dosyaId).dblclick(function() { window.open( "getDosya.do?id=" + $(this).attr('id'));  });								$('#'+data.dosyaId).parent().click( function() { selectImage($(this)); } );								selectImage($('#'+data.dosyaId).parent());															},							error:function(xhr,err,e){ alert( "Hata: " + err );}});					} else if (response.message) {						alert(response.message);					};					Agem.perde(false);			} });		addRemoveHover();		$('#sayfaResim').sortable( {			update : function(ser)			{				Agem.perde(true, null, 'Lütfen bekleyin...');				$.ajax({"url":"genel/sayfaResim/edit.do",					data:{ sayfaId: <bean:write name="p_sayfaIdParam"/>, siralama: $('#sayfaResim').sortable( "serialize"), json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){  					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});				Agem.perde(false);			}			});		<%		if ((p_yetki != null || !"".equals(p_yetki)) && "1".equals(p_yetki)) {		%>				$("#multiUploadBtn").remove();				$("#kaydet").remove();				$("#yeni").remove();				<% yetkiVar = false; %>		<%		}		%>				$("#url").click( function () {			$(this).select();		});	});var _SELECTED = null;var _SELECTED_INDEX = -1;function selectImage(r) {		if (_SELECTED != null) {		_SELECTED.removeClass("resimCerceveSelected")	} 	if (r) {		_SELECTED = r;		_SELECTED.addClass("resimCerceveSelected");				var index = r.attr("fileIndex");		_SELECTED_INDEX = index;		Agem.setValue(AgemTable.DATA[index]);		AgemForm.setRadioButtonValue("ekBilgi",AgemTable.DATA[index].ekBilgi);		$('#dosya').attr("disabled", true);		var id = AgemTable.DATA[index].dosyaId;		$('#url').val("<%=Constant.C_RESIM_URL%>"+id);		$('#url').parent().show();		$('#dosya').parent().hide();	} else {		_SELECTED = null;		_SELECTED_INDEX = -1;	}}function changeRemoveIcon() {	if ($(this).attr('className') =='kapat_icon_16')		$(this).removeClass('kapat_icon_16').addClass('kapat_icon_24');	else			$(this).removeClass('kapat_icon_24').addClass('kapat_icon_16');}function addRemoveHover() {		$('.kapat_icon_16').hover( changeRemoveIcon );		$('.resim').dblclick(function() { window.open( $(this).attr('src')); });		$('.resimCerceve').click( function() { selectImage($(this)) } );}function resimSil(sayfaBelgeId, dosyaId) {	<%	if (!yetkiVar) {	%>		Agem.error("Yetkiniz yok.");		return false;	<%	}	%>	if (confirm('Resmi silmek istediğinizden emin misiniz ?')) {		Agem.perde(true, null, 'Lütfen bekleyin...');		$.ajax({"url":"genel/sayfaResim/delete.do",			data:{ sayfaBelgeId: sayfaBelgeId, json:1 },			async : false,			timeout: 30000, 			dataType:"json", 			success:function(data){ 				$.ajax({"url":"deleteDosya.do",					data:{ dosyaId: dosyaId, json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){ 						$('#resimCerceve_'+sayfaBelgeId).remove();						dosyaTemizle();					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});			},			error:function(xhr,err,e){ alert( "Hata: " + err );}});			Agem.perde(false);	}}function resimUpdate() {	<%	if (!yetkiVar) {	%>		Agem.error("Yetkiniz yok.");		return false;	<%	}	%>	if($("#dosyaId").val()) {		Agem.perde(true, null, 'Lütfen bekleyin...');		var eskiEkBilgi = AgemTable.DATA[_SELECTED_INDEX].ekBilgi;		$.ajax({"url":"genel/sayfaResim/edit.do",			data:{ sayfaBelgeId: $("#sayfaBelgeId").val(), sayfaId: $("#sayfaId").val(), dosyaId: $("#dosyaId").val(), sira: $("#sira").val(), json:1, ekBilgi: AgemForm.getRadioButtonValue("ekBilgi") },			async : false,			timeout: 30000, 			dataType:"json", 			success:function(data){				$.ajax({"url":"editDosya.do",					data:{ dosyaId: $("#dosyaId").val(), tanim: $("#tanim").val(), tanimUpdate:'true', json:1 },					async : false,					timeout: 30000, 					dataType:"json", 					success:function(data){  						AgemTable.DATA[_SELECTED_INDEX].tanim = $("#tanim").val(); 						AgemTable.DATA[_SELECTED_INDEX].ekBilgi = AgemForm.getRadioButtonValue("ekBilgi");						$('#resimCerceve_' + AgemTable.DATA[_SELECTED_INDEX].sayfaBelgeId).removeClass("ekBilgi"+eskiEkBilgi);						$('#resimCerceve_' + AgemTable.DATA[_SELECTED_INDEX].sayfaBelgeId).addClass("ekBilgi"+AgemTable.DATA[_SELECTED_INDEX].ekBilgi);					},					error:function(xhr,err,e){ alert( "Hata: " + err );}});			},			error:function(xhr,err,e){ alert( "Hata: " + err );}});		Agem.perde(false);	}}function dosyaKaydet() {	<%	if (!yetkiVar) {	%>		Agem.error("Yetkiniz yok.");		return false;	<%	}	%>	if ($("#dosyaId").val()) {		resimUpdate();	} else {		if (AgemForm.validate($("#dosyaForm")[0])) {			$('#dosyaForm').submit();		}	}}function dosyaTemizle() {		AgemForm.temizle($("#dosyaForm")[0]);	$('#dosya').removeAttr("disabled");	$('#dosya').parent().show();	$('#url').parent().hide();		selectImage(null);}function multipleUpload() {		var x = [				'sayfaIdParam=' + <bean:write name="p_sayfaIdParam"/>,				'tanimParam=' + Agem.byId('tanim').value,				'turParam=1',				'ekBilgiParam='+ AgemForm.getRadioButtonValue("ekBilgi"),				'fileCntParam='+ fileCnt			];		AgemWM.modal({ url:"genel/sayfaResim/select.do?" + x.join('&'),					label: "Çoklu Dosya Yükleme",					close: false,					width: 500, 					height: 400,					buttons: [							   {								   label: "Tamam",								   func: function(obj) {window.location.reload(); return true;}							   }							]				}					);		}fileCnt = <%=n%>; AgemTable.DATA[<%=n%>]=<%=AgemUtils.jsObject(item)%>	</script>
</arya>
